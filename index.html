<!DOCTYPE html>
<html>
  <head>
    <title>form</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
    <script src="js.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="container">
      <h2 class="text-center">Click the button and wait</h2>
      <form id="form" method="post">
        <div class="form-group">
          <label class="d-none" for="Age">Age</label>
          <input
            type="text"
            class="form-control d-none"
            id="exampleInputfirstname"
            value="life_time"
            name="Timeperiod"
          />
        </div>
        <button type="submit" class="btn btn-primary" name="create">
          show User
        </button>
      </form>
    </div>
    <div id="user" class="user"></div>
    <table id="mytable" class="mt-4 table table-success table-striped">
      <thead>
        <tr>
          <th scope="col">Username</th>
          <th scope="col">Title</th>
          <th scope="col">discription</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      const form = document.getElementById("form");
      form.addEventListener("submit", async function (e) {
        e.preventDefault();
        const formData = new FormData(form);
        console.log([...formData]);
        try {
          const res = await axios.post(
            "https://100055.pythonanywhere.com/api/report/candidate_name/",
            formData
          );
          console.log(res);
          console.log(res.data.candidate);
          let output = document.getElementById("user");
          res.data.candidate.forEach((element) => {
            output.innerHTML += `
          <a id = "username" name = "username" onclick='bookmark(this)' value = "${element}" href="#">Name:${element}</a><br>
          `;
          });
        } catch (error) {
          console.log(error);
        }
      });
      async function bookmark(lnk) {
        const res = lnk.getAttribute("value");
        console.log(res);
        var dict = {};
        try {
          const obj = await axios.get(
            "https://100055.pythonanywhere.com/api/jobs/get_tasks/"
          );
          console.log(obj.data);
          let output = document.getElementById("username");
          obj.data.forEach((element) => {
            if (res == element.user) {
              console.log("user:", element.user);
              (dict["title"] = element.title),
                (dict["description"] = element.description);
              var tbodyRef = document
                .getElementById("mytable")
                .getElementsByTagName("tbody")[0];

              // Insert a row at the end of table
              var newRow = tbodyRef.insertRow();

              // Insert a cell at the end of the row
              var Cell0 = newRow.insertCell(0);
              var Cell1 = newRow.insertCell(1);
              var Cell2 = newRow.insertCell(2);

              // Append a text node to the cell
              var newuser = document.createTextNode(element.user);
              Cell0.appendChild(newuser);
              var newtitle = document.createTextNode(element.title);
              Cell1.appendChild(newtitle);
              var newText = document.createTextNode(element.description);
              Cell2.appendChild(newText);
            } else {
              console.log("discription:");
            }
          });
        } catch (error) {
          console.log(error);
        }
      }
    </script>
  </body>
</html>
